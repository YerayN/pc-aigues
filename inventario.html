<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intranet PC Aig√ºes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #d35400; }
        
        /* ‚ö° NUEVO: Estilos para el formulario de a√±adir */
        .formulario-add { background: #eee; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: flex; gap: 10px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; flex-grow: 1; }
        button.btn-add { background: #27ae60; color: white; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; border-radius: 4px;}
        
        .item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .btn-restar { background: #e74c3c; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üì¶ Inventario Interno</h1>

        <div class="formulario-add">
            <input type="text" id="nuevoNombre" placeholder="Ej: Walkie Talkie">
            <input type="number" id="nuevaCantidad" placeholder="Cant." style="max-width: 60px;">
            <button class="btn-add" onclick="agregarMaterial()">A√±adir</button>
        </div>
        
        <div id="lista-materiales">
            <p>Cargando datos...</p>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACI√ìN ---
        // ¬°¬°¬°¬° PEGA AQU√ç TUS CLAVES OTRA VEZ !!!!
        const SU_URL = 'https://irmkphwdqavkzbgszkon.supabase.co';
        const SU_KEY = 'sb_publishable_YE4P7UxXiUbAMdXKBPRKYQ_RkrsgsDE';
        
        const clienteSupabase = supabase.createClient(SU_URL, SU_KEY);

        // --- 2. LEER DATOS ---
        async function cargarInventario() {
            const { data, error } = await clienteSupabase
                .from('material')
                .select('*')
                .order('id', { ascending: false }); // ‚ö° CAMBIO: false para que lo nuevo salga arriba

            if (error) {
                console.error("Error:", error);
                return;
            }

            let html = '';
            data.forEach(producto => {
                html += `
                    <div class="item">
                        <span>
                            <strong>${producto.nombre}</strong> 
                            (Stock: ${producto.cantidad})
                        </span>
                        
                        <div style="display: flex; gap: 5px;">
                            <button class="btn-restar" 
                                    onclick="cogerMaterial(${producto.id}, ${producto.cantidad})">
                                -1
                            </button>

                            <button onclick="borrarMaterial(${producto.id})" 
                                    style="background: #555; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('lista-materiales').innerHTML = html;
        }

        // --- 3. MODIFICAR DATOS (UPDATE) ---
        async function cogerMaterial(idProducto, cantidadActual) {
            if (cantidadActual <= 0) { alert("¬°No queda stock!"); return; }
            
            const { error } = await clienteSupabase
                .from('material')
                .update({ cantidad: cantidadActual - 1 })
                .eq('id', idProducto);

            if (error) alert("Error: " + error.message);
            else cargarInventario();
        }

        // --- 4. ‚ö° NUEVO: A√ëADIR DATOS (INSERT) ---
        async function agregarMaterial() {
            // 1. Cogemos lo que has escrito en las cajitas
            const nombreInput = document.getElementById('nuevoNombre');
            const cantidadInput = document.getElementById('nuevaCantidad');
            
            const nombre = nombreInput.value;
            const cantidad = cantidadInput.value;

            // Validaci√≥n b√°sica: que no est√© vac√≠o
            if (!nombre || !cantidad) {
                alert("Por favor, rellena nombre y cantidad");
                return;
            }

            // 2. Hablamos con Supabase: "Inserta esto en la tabla"
            const { error } = await clienteSupabase
                .from('material')
                .insert({ nombre: nombre, cantidad: cantidad });

            if (error) {
                alert("Error al a√±adir: " + error.message);
            } else {
                // 3. Limpiamos las cajitas y recargamos la lista
                nombreInput.value = '';
                cantidadInput.value = '';
                cargarInventario();
            }
        }

        // --- 5. ‚ö° NUEVO: BORRAR DATOS (DELETE) ---
        async function borrarMaterial(idProducto) {
            // 1. Cintur√≥n de seguridad: Preguntamos primero
            if (!confirm("¬øEst√°s seguro de que quieres ELIMINAR este producto del inventario?")) {
                return; // Si dice que no, paramos la funci√≥n aqu√≠.
            }

            // 2. Hablamos con Supabase: "Borra de la tabla material donde id sea X"
            const { error } = await clienteSupabase
                .from('material')
                .delete()
                .eq('id', idProducto);

            if (error) {
                alert("Error al borrar: " + error.message);
            } else {
                // 3. Recargamos la lista
                cargarInventario();
            }
        }

        // Arrancamos
        cargarInventario();
    </script>
</body>
</html>